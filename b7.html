<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Python Code Card ‚Äî Short Answer Quiz</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --secondary: #8b5cf6;
      --success: #10b981;
      --error: #ef4444;
      --warning: #f59e0b;
      --bg-gradient-start: #f0f9ff;
      --bg-gradient-end: #e0f2fe;
      --card-bg: #ffffff;
      --code-bg: #fef3c7;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --border: #e2e8f0;
      --shadow: rgba(0, 0, 0, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      min-height: 100vh;
      padding: 20px;
      color: var(--text-primary);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: 0 20px 60px var(--shadow);
      overflow: hidden;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Admin Button */
    .admin-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(139, 92, 246, 0.9);
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .admin-toggle:hover {
      background: rgba(109, 40, 217, 0.9);
      transform: translateY(-2px);
    }

    /* Admin Login Screen */
    .admin-login {
      display: none;
      padding: 60px 40px;
      text-align: center;
      background: linear-gradient(135deg, #8b5cf6 0%, #6d28d9 100%);
      color: white;
    }

    .admin-login h2 {
      font-size: 2rem;
      margin-bottom: 16px;
    }

    .admin-login p {
      margin-bottom: 30px;
      opacity: 0.9;
    }

    .passcode-input-group {
      max-width: 350px;
      margin: 0 auto 20px;
    }

    .passcode-input-group input {
      width: 100%;
      padding: 16px 20px;
      font-size: 1.2rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      background: rgba(255,255,255,0.95);
      color: var(--text-primary);
      text-align: center;
      letter-spacing: 4px;
      font-weight: 600;
    }

    .passcode-input-group input:focus {
      outline: none;
      border-color: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .admin-login-btn {
      background: white;
      color: var(--secondary);
      border: none;
      padding: 14px 40px;
      font-size: 1rem;
      font-weight: 700;
      border-radius: 12px;
      cursor: pointer;
      margin-right: 10px;
      transition: all 0.3s ease;
    }

    .admin-login-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    }

    .back-btn {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 2px solid white;
    }

    .error-message {
      color: #fecaca;
      margin-top: 16px;
      font-weight: 600;
    }

    /* Admin Dashboard */
    .admin-dashboard {
      display: none;
      padding: 40px;
    }

    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid var(--border);
    }

    .admin-header h2 {
      color: var(--secondary);
      font-size: 1.8rem;
    }

    .logout-btn {
      background: var(--error);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 15px var(--shadow);
    }

    .stat-card h3 {
      font-size: 0.9rem;
      opacity: 0.9;
      margin-bottom: 8px;
    }

    .stat-card .value {
      font-size: 2.5rem;
      font-weight: 700;
    }

    .students-table {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 15px var(--shadow);
    }

    .students-table h3 {
      background: #f8fafc;
      padding: 20px;
      margin: 0;
      border-bottom: 2px solid var(--border);
      color: var(--text-primary);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f1f5f9;
    }

    th {
      padding: 16px;
      text-align: left;
      font-weight: 600;
      color: var(--text-secondary);
      font-size: 0.9rem;
      text-transform: uppercase;
    }

    td {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    tbody tr:hover {
      background: #f8fafc;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .status-in-progress {
      background: #fef3c7;
      color: #92400e;
    }

    .status-completed {
      background: #d1fae5;
      color: #065f46;
    }

    .score-display {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .score-excellent {
      color: var(--success);
    }

    .score-good {
      color: var(--primary);
    }

    .score-fair {
      color: var(--warning);
    }

    .score-poor {
      color: var(--error);
    }

    .no-data {
      padding: 40px;
      text-align: center;
      color: var(--text-secondary);
    }

    /* Welcome Screen */
    .welcome-screen {
      padding: 60px 40px;
      text-align: center;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
    }

    .welcome-screen h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 16px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .welcome-screen p {
      font-size: 1.1rem;
      margin-bottom: 40px;
      opacity: 0.95;
    }

    .name-input-group {
      max-width: 400px;
      margin: 0 auto 30px;
    }

    .name-input-group label {
      display: block;
      text-align: left;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }

    .name-input-group input {
      width: 100%;
      padding: 16px 20px;
      font-size: 1.1rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      background: rgba(255,255,255,0.95);
      color: var(--text-primary);
      transition: all 0.3s ease;
    }

    .name-input-group input:focus {
      outline: none;
      border-color: white;
      background: white;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }

    .start-btn {
      background: white;
      color: var(--primary);
      border: none;
      padding: 16px 48px;
      font-size: 1.1rem;
      font-weight: 700;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(0,0,0,0.3);
    }

    .start-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    /* Quiz Screen */
    .quiz-screen {
      display: none;
    }

    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    .header-left h1 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .student-name {
      font-size: 0.95rem;
      opacity: 0.9;
    }

    .timer {
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(10px);
      padding: 12px 24px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.2rem;
      color: white;
      border: 2px solid rgba(255,255,255,0.3);
      min-width: 120px;
      text-align: center;
    }

    .timer.warning {
      background: var(--warning);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .content {
      padding: 32px;
    }

    .meta {
      background: #f1f5f9;
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 24px;
      font-size: 0.95rem;
      color: var(--text-secondary);
      border-left: 4px solid var(--primary);
    }

    .card {
      background: var(--code-bg);
      border: 2px solid #fbbf24;
      padding: 20px;
      border-radius: 12px;
      font-family: "Fira Code", "Courier New", monospace;
      font-size: 14px;
      color: #1e293b;
      margin-bottom: 24px;
      white-space: pre;
      overflow: auto;
      max-height: 300px;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.2);
    }

    .question-area {
      background: #f8fafc;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      border: 2px solid var(--border);
    }

    .question {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--text-primary);
      line-height: 1.6;
    }

    textarea.answer {
      width: 100%;
      min-height: 100px;
      resize: vertical;
      padding: 16px;
      font-size: 1rem;
      border-radius: 12px;
      border: 2px solid var(--border);
      font-family: "Segoe UI", Tahoma, Verdana, sans-serif;
      transition: all 0.3s ease;
      background: white;
    }

    textarea.answer:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    button {
      background: var(--primary);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
    }

    button:hover:not(:disabled) {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    #nextBtn {
      background: var(--success);
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    #nextBtn:hover:not(:disabled) {
      background: #059669;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }

    .feedback {
      font-weight: 700;
      font-size: 1.1rem;
      padding: 8px 16px;
      border-radius: 8px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .feedback.ok {
      color: var(--success);
      background: rgba(16, 185, 129, 0.1);
    }

    .feedback.bad {
      color: var(--error);
      background: rgba(239, 68, 68, 0.1);
    }

    .progress-bar-container {
      background: #e2e8f0;
      height: 8px;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 16px;
    }

    .progress-bar {
      background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
      height: 100%;
      transition: width 0.5s ease;
      border-radius: 10px;
    }

    #progress {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 24px;
      font-weight: 600;
      text-align: center;
    }

    .summary {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      padding: 32px;
      border-radius: 12px;
      border: 2px solid var(--success);
      margin-top: 24px;
    }

    .summary h2 {
      color: var(--success);
      margin-bottom: 16px;
      font-size: 1.8rem;
    }

    .summary h3 {
      margin-top: 24px;
      margin-bottom: 16px;
      color: var(--text-primary);
      font-size: 1.3rem;
    }

    .answers-list {
      background: white;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .answers-list > div {
      padding: 16px;
      border-bottom: 1px solid var(--border);
    }

    .answers-list > div:last-child {
      border-bottom: none;
    }

    .answers-list code {
      background: #f1f5f9;
      padding: 4px 8px;
      border-radius: 6px;
      font-family: "Fira Code", monospace;
      font-size: 0.9rem;
      color: var(--primary);
      display: inline-block;
      margin: 4px;
    }

    footer {
      background: #f8fafc;
      padding: 20px 32px;
      font-size: 0.9rem;
      color: var(--text-secondary);
      border-top: 1px solid var(--border);
    }

    @media (max-width: 768px) {
      .welcome-screen {
        padding: 40px 24px;
      }

      .welcome-screen h1 {
        font-size: 1.8rem;
      }

      header {
        padding: 20px 24px;
      }

      .content {
        padding: 24px 20px;
      }

      .header-left h1 {
        font-size: 1.2rem;
      }

      .timer {
        font-size: 1rem;
        padding: 10px 20px;
      }

      .admin-dashboard {
        padding: 20px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      table {
        font-size: 0.85rem;
      }

      th, td {
        padding: 12px 8px;
      }
    }
  </style>
</head>
<body>
  <!-- Admin Toggle Button -->
  <button class="admin-toggle" id="adminToggle">üîê Admin</button>

  <div class="container" role="main">
    <!-- Admin Login Screen -->
    <div class="admin-login" id="adminLogin">
      <h2>üîê Admin Access</h2>
      <p>Enter the passcode to view student progress and scores</p>
      
      <div class="passcode-input-group">
        <input 
          type="password" 
          id="passcodeInput" 
          placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
          maxlength="6"
        />
      </div>
      
      <button class="admin-login-btn" id="loginBtn">Login</button>
      <button class="admin-login-btn back-btn" id="backFromLogin">Back</button>
      
      <div class="error-message" id="loginError" style="display:none"></div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
      <div class="admin-header">
        <h2>üìä Admin Dashboard</h2>
        <button class="logout-btn" id="logoutBtn">Logout</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <h3>Total Students</h3>
          <div class="value" id="totalStudents">0</div>
        </div>
        <div class="stat-card">
          <h3>In Progress</h3>
          <div class="value" id="inProgressCount">0</div>
        </div>
        <div class="stat-card">
          <h3>Completed</h3>
          <div class="value" id="completedCount">0</div>
        </div>
        <div class="stat-card">
          <h3>Average Score</h3>
          <div class="value" id="averageScore">-</div>
        </div>
      </div>

      <div class="students-table">
        <h3>Student Progress & Scores</h3>
        <table>
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Status</th>
              <th>Progress</th>
              <th>Score</th>
              <th>Started At</th>
            </tr>
          </thead>
          <tbody id="studentsTableBody">
            <tr>
              <td colspan="5" class="no-data">No students have started the quiz yet</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
      <h1>üêç Python Code Quiz</h1>
      <p>Test your understanding of Python basics with this interactive quiz. Read the code carefully and answer each question correctly to proceed.</p>
      
      <div class="name-input-group">
        <label for="studentName">Enter Your Full Name</label>
        <input 
          type="text" 
          id="studentName" 
          placeholder="e.g., John Doe" 
          autocomplete="name"
          required
        />
      </div>
      
      <button class="start-btn" id="startQuizBtn" disabled>Start Quiz</button>
    </div>

    <!-- Quiz Screen -->
    <div class="quiz-screen" id="quizScreen">
      <header>
        <div class="header-left">
          <h1>Python ‚Äî Read & Answer Quiz</h1>
          <div class="student-name">Student: <strong id="displayName"></strong></div>
        </div>
        <div class="timer" id="timer">30:00</div>
      </header>

      <div class="content">
        <div class="meta">
          üìñ Read the code below (it appears on every question). Type the answer in the box. You must give the correct answer to move to the next question. Press Enter to check.
        </div>

        <div class="progress-bar-container">
          <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>

        <!-- Code card -->
        <div class="card" id="codeCard">name = "Ama"
age = 13
height = 1.55
isStudent = True
subjects = ["Math", "English", "ICT"]

print("Student Name:", name)
print("Age:", age)
print("Height:", height)
print("Is a Student?", isStudent)
print("Favourite Subjects:", subjects)

if age >= 13:
    print("You are old enough to join the ICT Club.")
else:
    print("Sorry, you need to wait another year.")</div>

        <!-- Question -->
        <div class="question-area">
          <div class="question" id="questionText">Question will appear here</div>
          <textarea id="answerBox" class="answer" placeholder="Type your answer here..."></textarea>
          <div class="controls">
            <button id="checkBtn">Check Answer (Enter)</button>
            <button id="nextBtn" style="display:none">Next Question ‚Üí</button>
            <div id="feedback" class="feedback" aria-live="polite"></div>
          </div>
        </div>

        <div id="progress">Question <span id="qNum">1</span> of <span id="qTotal">7</span></div>

        <div id="resultArea" style="display:none" class="summary" aria-live="polite"></div>
      </div>

      <footer>
        üí° <strong>Tip:</strong> Acceptable answers include common correct forms (e.g., "string" or "str" for text). The exact output question expects the printed lines shown by the program.
      </footer>
    </div>
  </div>

  <script>
    // ADMIN PASSCODE
    const ADMIN_PASSCODE = "027922";
    
    // QUIZ QUESTIONS
    const questions = [
      {
        id: "a_name",
        prompt: "a. Write down the data type used for: name",
        answers: ["string","str","text"]
      },
      {
        id: "a_age",
        prompt: "b. Write down the data type used for: age",
        answers: ["integer","int","whole number","number (int)","number"]
      },
      {
        id: "a_height",
        prompt: "c. Write down the data type used for: height",
        answers: ["float","decimal","float (float)","real number","double"]
      },
      {
        id: "a_isStudent",
        prompt: "d. Write down the data type used for: isStudent",
        answers: ["boolean","bool","true/false","true or false"]
      },
      {
        id: "a_subjects",
        prompt: "e. Write down the data type used for: subjects",
        answers: ["list","array","list (list)","python list"]
      },
      {
        id: "b_if",
        prompt: "b. What is the purpose of the 'if' statement in the code above?",
        answers: [
          "to check if age is greater than or equal to 13 and show the appropriate message",
          "to check if age >= 13 and print a message about joining the ict club",
          "checks whether the student is at least 13 and prints either allowed or wait message",
          "to check age and decide if the student is old enough to join the ICT Club"
        ],
        keywords: ["check","age","13","join","ict","club","message",">=13","13 or older","old enough"]
      },
      {
        id: "c_age11",
        prompt: "c. If age is changed to 11, what message will the program display at the end?",
        answers: ["sorry, you need to wait another year.","sorry you need to wait another year","sorry, you need to wait another year"]
      },
      {
        id: "d_output",
        prompt: "d. Write the exact output that will appear on the screen when the program runs as it is.\n(Include each printed line on its own line ‚Äî be careful to match text and punctuation.)",
        answers: [
`Student Name: Ama
Age: 13
Height: 1.55
Is a Student? True
Favourite Subjects: ['Math', 'English', 'ICT']
You are old enough to join the ICT Club.`,
`Student Name: Ama
Age: 13
Height: 1.55
Is a Student? True
Favourite Subjects: ["Math", "English", "ICT"]
You are old enough to join the ICT Club.`
        ],
        normalizeMultiLine: true
      },
      {
        id: "e_diff",
        prompt: "e. Explain the difference between the data types used for age and height.",
        answers: [
          "age is an integer (whole number) while height is a float (has decimal)",
          "age is int (whole number) and height is float (decimal number)",
          "age = integer; height = float (decimal)"
        ],
        keywords: ["integer","int","whole","float","decimal","decimal number","has decimal"]
      },
      {
        id: "f_append",
        prompt: "f. The ICT teacher wants to add the subject \"Science\" to the list. Write the Python line of code that will do that.",
        answers: ["subjects.append(\"Science\")","subjects.append('Science')","subjects.append(\\\"Science\\\")","subjects.append('Science')"]
      },
      {
        id: "g_errors",
        prompt: "g. Suggest two possible errors that could occur if a student mistakenly types the variable name wrongly (e.g., Name instead of name). (Give two short answers separated by comma or on separate lines.)",
        answers: [
          "nameerror","NameError","variable not defined","variable not found","undefined variable"
        ],
        keywords: ["nameerror","undefined","not defined","variable","case sensitive","case-sensitivity","error"]
      }
    ];

    const totalQuestions = questions.length;

    // UI references
    const adminToggle = document.getElementById("adminToggle");
    const adminLogin = document.getElementById("adminLogin");
    const adminDashboard = document.getElementById("adminDashboard");
    const welcomeScreen = document.getElementById("welcomeScreen");
    const quizScreen = document.getElementById("quizScreen");
    const passcodeInput = document.getElementById("passcodeInput");
    const loginBtn = document.getElementById("loginBtn");
    const backFromLogin = document.getElementById("backFromLogin");
    const loginError = document.getElementById("loginError");
    const logoutBtn = document.getElementById("logoutBtn");
    const studentNameInput = document.getElementById("studentName");
    const startQuizBtn = document.getElementById("startQuizBtn");
    const displayName = document.getElementById("displayName");
    const qText = document.getElementById("questionText");
    const answerBox = document.getElementById("answerBox");
    const checkBtn = document.getElementById("checkBtn");
    const nextBtn = document.getElementById("nextBtn");
    const feedback = document.getElementById("feedback");
    const qNum = document.getElementById("qNum");
    const qTotal = document.getElementById("qTotal");
    const timerEl = document.getElementById("timer");
    const resultArea = document.getElementById("resultArea");
    const progressBar = document.getElementById("progressBar");

    qTotal.textContent = totalQuestions;

    let current = 0;
    let score = 0;
    let studentName = "";
    let studentId = "";
    const userAnswers = [];

    // Timer setup (30 minutes)
    let remaining = 30 * 60;
    let timerInterval = null;

    // ========== ADMIN FUNCTIONS ==========
    
    function showAdminLogin() {
      welcomeScreen.style.display = "none";
      quizScreen.style.display = "none";
      adminLogin.style.display = "block";
      adminDashboard.style.display = "none";
      passcodeInput.value = "";
      loginError.style.display = "none";
      passcodeInput.focus();
    }

    function showAdminDashboard() {
      welcomeScreen.style.display = "none";
      quizScreen.style.display = "none";
      adminLogin.style.display = "none";
      adminDashboard.style.display = "block";
      refreshAdminDashboard();
      // Auto-refresh every 2 seconds
      if (window.adminRefreshInterval) clearInterval(window.adminRefreshInterval);
      window.adminRefreshInterval = setInterval(refreshAdminDashboard, 2000);
    }

    function backToWelcome() {
      adminLogin.style.display = "none";
      adminDashboard.style.display = "none";
      welcomeScreen.style.display = "block";
      if (window.adminRefreshInterval) clearInterval(window.adminRefreshInterval);
    }

    function refreshAdminDashboard() {
      const students = getAllStudents();
      
      // Update stats
      document.getElementById("totalStudents").textContent = students.length;
      
      const inProgress = students.filter(s => s.status === "in-progress").length;
      const completed = students.filter(s => s.status === "completed").length;
      document.getElementById("inProgressCount").textContent = inProgress;
      document.getElementById("completedCount").textContent = completed;
      
      // Calculate average score
      const completedStudents = students.filter(s => s.status === "completed");
      if (completedStudents.length > 0) {
        const avg = completedStudents.reduce((sum, s) => sum + s.score, 0) / completedStudents.length;
        document.getElementById("averageScore").textContent = avg.toFixed(1);
      } else {
        document.getElementById("averageScore").textContent = "-";
      }
      
      // Update table
      const tbody = document.getElementById("studentsTableBody");
      if (students.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="no-data">No students have started the quiz yet</td></tr>';
      } else {
        tbody.innerHTML = students.map(student => {
          const statusClass = student.status === "completed" ? "status-completed" : "status-in-progress";
          const statusText = student.status === "completed" ? "Completed" : "In Progress";
          
          let scoreDisplay = "-";
          let scoreClass = "";
          if (student.status === "completed") {
            const percentage = (student.score / totalQuestions) * 100;
            scoreDisplay = `${student.score}/${totalQuestions} (${percentage.toFixed(0)}%)`;
            if (percentage >= 90) scoreClass = "score-excellent";
            else if (percentage >= 70) scoreClass = "score-good";
            else if (percentage >= 50) scoreClass = "score-fair";
            else scoreClass = "score-poor";
          }
          
          const progressText = student.status === "completed" 
            ? `${totalQuestions}/${totalQuestions}` 
            : `${student.currentQuestion}/${totalQuestions}`;
          
          return `
            <tr>
              <td><strong>${escapeHtml(student.name)}</strong></td>
              <td><span class="status-badge ${statusClass}">${statusText}</span></td>
              <td>${progressText}</td>
              <td class="score-display ${scoreClass}">${scoreDisplay}</td>
              <td>${new Date(student.startedAt).toLocaleString()}</td>
            </tr>
          `;
        }).join('');
      }
    }

    function getAllStudents() {
      const studentsData = localStorage.getItem("quizStudents");
      return studentsData ? JSON.parse(studentsData) : [];
    }

    function saveStudentData(studentData) {
      const students = getAllStudents();
      const index = students.findIndex(s => s.id === studentData.id);
      if (index >= 0) {
        students[index] = studentData;
      } else {
        students.push(studentData);
      }
      localStorage.setItem("quizStudents", JSON.stringify(students));
    }

    // Admin event listeners
    adminToggle.addEventListener("click", showAdminLogin);
    
    loginBtn.addEventListener("click", () => {
      if (passcodeInput.value === ADMIN_PASSCODE) {
        showAdminDashboard();
      } else {
        loginError.textContent = "‚ùå Incorrect passcode. Please try again.";
        loginError.style.display = "block";
        passcodeInput.value = "";
        passcodeInput.focus();
      }
    });

    passcodeInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        loginBtn.click();
      }
    });

    backFromLogin.addEventListener("click", backToWelcome);
    
    logoutBtn.addEventListener("click", () => {
      if (window.adminRefreshInterval) clearInterval(window.adminRefreshInterval);
      backToWelcome();
    });

    // ========== QUIZ FUNCTIONS ==========
    
    // Enable start button when name is entered
    studentNameInput.addEventListener("input", () => {
      const name = studentNameInput.value.trim();
      startQuizBtn.disabled = name.length < 2;
    });

    studentNameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !startQuizBtn.disabled) {
        startQuiz();
      }
    });

    startQuizBtn.addEventListener("click", startQuiz);

    function startQuiz() {
      studentName = studentNameInput.value.trim();
      if (studentName.length < 2) return;

      // Generate unique student ID
      studentId = Date.now().toString() + Math.random().toString(36).substr(2, 9);
      
      // Save initial student data
      saveStudentData({
        id: studentId,
        name: studentName,
        status: "in-progress",
        currentQuestion: 1,
        score: 0,
        startedAt: new Date().toISOString()
      });

      displayName.textContent = studentName;
      welcomeScreen.style.display = "none";
      quizScreen.style.display = "block";
      
      showQuestion(0);
      startTimer();
    }

    function startTimer() {
      timerInterval = setInterval(() => {
        remaining--;
        if (remaining < 0) {
          clearInterval(timerInterval);
          endQuiz("‚è∞ Time's up!");
          return;
        }
        
        if (remaining <= 300) {
          timerEl.classList.add("warning");
        }
        
        const m = Math.floor(remaining / 60);
        const s = remaining % 60;
        timerEl.textContent = `${m}:${s < 10 ? '0'+s : s}`;
      }, 1000);
    }

    function normalize(s) {
      if (!s && s !== "") return "";
      return s.toString().trim().replace(/\s+/g, " ").toLowerCase();
    }

    function normalizeMultiLine(s) {
      return s.toString().trim().replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/[ \t]+\n/g,"\n").replace(/\n[ \t]+/g,"\n").trim();
    }

    function showQuestion(index) {
      const q = questions[index];
      qText.textContent = q.prompt;
      qNum.textContent = index + 1;
      answerBox.value = "";
      feedback.textContent = "";
      nextBtn.style.display = "none";
      checkBtn.disabled = false;
      answerBox.disabled = false;
      answerBox.focus();
      
      const progress = (index / totalQuestions) * 100;
      progressBar.style.width = progress + "%";
      
      // Update student progress in localStorage
      saveStudentData({
        id: studentId,
        name: studentName,
        status: "in-progress",
        currentQuestion: index + 1,
        score: score,
        startedAt: new Date().toISOString()
      });
    }

    function checkCurrentAnswer() {
      const q = questions[current];
      let user = answerBox.value || "";
      const normUser = normalize(user);
      
      if (q.normalizeMultiLine) {
        const normUserML = normalizeMultiLine(user).replace(/\s+$/,'');
        const ok = q.answers.some(acc => normalizeMultiLine(acc).toLowerCase() === normUserML.toLowerCase());
        if (ok) {
          markCorrect(user);
          return;
        } else {
          markWrong();
          return;
        }
      }

      const matchesList = q.answers.map(a => normalize(a));

      if (matchesList.includes(normUser)) {
        markCorrect(user);
        return;
      }

      if (q.keywords && q.keywords.length) {
        const allPresent = q.keywords.every(kw => normUser.indexOf(kw.toLowerCase()) !== -1);
        if (allPresent) {
          markCorrect(user);
          return;
        }
      }

      if (q.id === "g_errors") {
        const lowered = normUser;
        const found = questions[current].answers.some(a => lowered.indexOf(normalize(a)) !== -1);
        if (found) {
          markCorrect(user);
          return;
        }
      }

      markWrong();
    }

    function markCorrect(userText) {
      feedback.className = "feedback ok";
      feedback.textContent = "‚úÖ Correct!";
      checkBtn.disabled = true;
      answerBox.disabled = true;
      nextBtn.style.display = "inline-block";
      score++;
      userAnswers.push({ id: questions[current].id, question: questions[current].prompt, answerGiven: userText, correct: true });
    }

    function markWrong() {
      feedback.className = "feedback bad";
      feedback.textContent = "‚ùå Try again!";
      userAnswers.push({ id: questions[current].id, question: questions[current].prompt, answerGiven: answerBox.value, correct: false });
    }

    nextBtn.addEventListener("click", () => {
      current++;
      if (current >= totalQuestions) {
        clearInterval(timerInterval);
        progressBar.style.width = "100%";
        endQuiz("üéâ Quiz complete!");
        return;
      }
      showQuestion(current);
    });

    checkBtn.addEventListener("click", checkCurrentAnswer);
    answerBox.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        checkCurrentAnswer();
      }
    });

    function endQuiz(message) {
      // Save final student data
      saveStudentData({
        id: studentId,
        name: studentName,
        status: "completed",
        currentQuestion: totalQuestions,
        score: score,
        startedAt: new Date().toISOString()
      });

      document.querySelector(".question-area").style.display = "none";
      document.getElementById("progress").style.display = "none";

      let answersHtml = "";
      questions.forEach((q, idx) => {
        const accepted = q.normalizeMultiLine
          ? q.answers.map(a => `<code>${escapeHtml(normalizeMultiLine(a))}</code>`).join("<br>")
          : q.answers.map(a => `<code>${escapeHtml(a)}</code>`).join(", ");
        answersHtml += `<div><b>${idx+1}. ${escapeHtml(q.prompt)}</b><div style="margin-top:8px"><span style="color:#2563eb;font-weight:600">Accepted answer(s):</span> ${accepted}</div></div>`;
      });

      const percentage = Math.round((score / totalQuestions) * 100);
      let gradeEmoji = "üìù";
      if (percentage >= 90) gradeEmoji = "üèÜ";
      else if (percentage >= 70) gradeEmoji = "‚≠ê";
      else if (percentage >= 50) gradeEmoji = "üëç";

      resultArea.style.display = "block";
      resultArea.innerHTML = `
        <h2>${gradeEmoji} ${escapeHtml(message)}</h2>
        <p style="font-size:1.2rem;margin:16px 0"><strong>Student:</strong> ${escapeHtml(studentName)}</p>
        <p style="font-size:1.5rem;font-weight:700;color:var(--success)">Your score: ${score} / ${totalQuestions} (${percentage}%)</p>
        <h3>üìö Accepted Answers (Reference)</h3>
        <div class="answers-list">${answersHtml}</div>
      `;
      resultArea.scrollIntoView({behavior:"smooth"});
    }

    function escapeHtml(text) {
      return text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
    }
  </script>
</body>
</html>