<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yeriel Bracha Computing Quiz</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #ff7b00 0%, #ff9500 50%, #ffb347 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      width: 90%;
      max-width: 900px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 2.2em;
      font-weight: 700;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
    }
    
    h2 {
      color: #34495e;
      margin-bottom: 20px;
      font-size: 1.3em;
      text-align: center;
    }
    
    .hidden { 
      display: none; 
    }
    
    /* Name Input Page */
    .name-section {
      text-align: center;
      padding: 20px;
    }
    
    .name-section p {
      font-size: 1.1em;
      color: #555;
      margin-bottom: 20px;
    }
    
    input[type="text"] {
      width: 100%;
      max-width: 400px;
      padding: 15px;
      border-radius: 10px;
      border: 2px solid #bdc3c7;
      font-size: 1.1em;
      margin: 15px auto;
      display: block;
      transition: border-color 0.3s ease;
    }
    
    input[type="text"]:focus {
      outline: none;
      border-color: #ff7b00;
      box-shadow: 0 0 0 3px rgba(255, 123, 0, 0.1);
    }
    
    /* Welcome Page */
    .welcome-content {
      text-align: center;
      padding: 20px;
    }
    
    .quiz-info {
      background: rgba(255, 123, 0, 0.1);
      border: 2px solid #ff7b00;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .quiz-info p {
      margin: 10px 0;
      font-size: 1.1em;
      color: #2c3e50;
    }
    
    marquee {
      background: linear-gradient(135deg, #ff7b00, #ff9500);
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin: 15px 0;
      font-weight: bold;
    }
    
    /* Buttons */
    button {
      background: linear-gradient(135deg, #ff7b00, #ff9500);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      margin: 10px;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    button:hover {
      background: linear-gradient(135deg, #ff9500, #ff7b00);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 123, 0, 0.4);
    }
    
    button:disabled {
      background: #95a5a6;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    button.secondary {
      background: #ecf0f1;
      color: #2c3e50;
      text-transform: none;
      letter-spacing: normal;
      padding: 12px 20px;
      margin: 5px;
      border-radius: 10px;
      font-weight: normal;
    }
    
    button.secondary:hover {
      background: #bdc3c7;
      transform: translateY(-1px);
    }
    
    button.selected {
      background: linear-gradient(135deg, #27ae60, #2ecc71) !important;
      color: white !important;
    }
    
    /* Countdown Screen */
    .countdown-screen {
      text-align: center;
      padding: 60px 20px;
      font-size: 4em;
      font-weight: bold;
      color: #ff7b00;
      animation: pulse 1s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.8; }
      50% { transform: scale(1.1); opacity: 1; }
    }
    
    /* Quiz Area */
    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 15px;
      background: rgba(255, 123, 0, 0.1);
      border-radius: 10px;
    }
    
    .question-counter {
      font-weight: bold;
      color: #2c3e50;
      font-size: 1.1em;
    }
    
    .timer {
      font-weight: bold;
      color: #e74c3c;
      font-size: 1.2em;
      padding: 8px 15px;
      background: rgba(231, 76, 60, 0.1);
      border-radius: 20px;
    }
    
    .timer.warning {
      animation: blink 1s infinite;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.5; }
    }
    
    .question-content {
      background: rgba(255, 255, 255, 0.8);
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 25px;
      border-left: 5px solid #ff7b00;
    }
    
    .question-text {
      font-size: 1.2em;
      color: #2c3e50;
      font-weight: 600;
      line-height: 1.5;
      margin-bottom: 20px;
    }
    
    .options-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-bottom: 25px;
    }
    
    .option-button {
      text-align: left;
      padding: 15px 20px;
      border-radius: 10px;
      font-size: 1em;
      line-height: 1.4;
      word-wrap: break-word;
    }
    
    .controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 30px;
    }
    
    .nav-buttons {
      display: flex;
      gap: 10px;
    }
    
    /* Results */
    .results {
      padding: 20px;
      text-align: center;
    }
    
    .score-display {
      background: linear-gradient(135deg, #2ecc71, #27ae60);
      color: white;
      padding: 25px;
      border-radius: 15px;
      margin: 20px 0;
      font-size: 1.3em;
    }
    
    .summary {
      text-align: left;
      margin-top: 30px;
      padding: 20px;
      background: rgba(236, 240, 241, 0.8);
      border-radius: 15px;
    }
    
    .summary h3 {
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
      font-size: 1.4em;
    }
    
    .question-review {
      margin: 15px 0;
      padding: 15px;
      background: white;
      border-radius: 10px;
      border-left: 4px solid #bdc3c7;
    }
    
    .question-review.correct {
      border-left-color: #27ae60;
    }
    
    .question-review.wrong {
      border-left-color: #e74c3c;
    }
    
    .correct { 
      color: #27ae60; 
      font-weight: bold; 
    }
    
    .wrong { 
      color: #e74c3c; 
      font-weight: bold; 
    }
    
    /* Footer */
    footer {
      text-align: center;
      margin-top: 40px;
      padding: 20px;
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      border-radius: 15px;
      font-size: 14px;
    }
    
    /* Lock Message */
    .lock-message {
      text-align: center;
      color: #e74c3c;
      font-weight: bold;
      background: rgba(231, 76, 60, 0.1);
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }
    
    /* Responsive Design */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
        margin: 10px;
        width: calc(100% - 20px);
      }
      
      h1 {
        font-size: 1.8em;
      }
      
      .countdown-screen {
        font-size: 3em;
        padding: 40px 20px;
      }
      
      .quiz-header {
        flex-direction: column;
        gap: 10px;
      }
      
      .controls {
        flex-direction: column;
        gap: 15px;
      }
      
      .nav-buttons {
        width: 100%;
        justify-content: space-between;
      }
      
      button {
        padding: 12px 20px;
        font-size: 1em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Name Input Page -->
    <div id="namePage" class="name-section">
      <h1>üéì Yeriel Bracha Computing Quiz</h1>
      <p>Welcome! Please enter your full name to begin the quiz.</p>
      <input type="text" id="studentName" placeholder="Enter your full name" />
      <button id="proceedBtn">Proceed to Quiz</button>
      <div id="lockMessage" class="lock-message hidden"></div>
    </div>

    <!-- Welcome Page -->
    <div id="welcomePage" class="welcome-content hidden">
      <h1>Welcome to Quizzilla! üöÄ</h1>
      <div class="quiz-info">
        <p>üìö <strong>Subject:</strong> Introduction to Computing</p>
        <marquee>Just select the correct answer for each question!</marquee>
        <p>‚è±Ô∏è <strong>Time Limit:</strong> 30 minutes</p>
        <p>‚ùì <strong>Questions:</strong> 30 questions (from 40 available)</p>
        <p>üéØ <strong>Instructions:</strong> Use Next and Previous to navigate, click Submit when done</p>
      </div>
      <button id="startBtn">üéØ Sure, Let's Start Quiz!</button>
    </div>

    <!-- Countdown Screen -->
    <div id="countdownScreen" class="countdown-screen hidden"></div>

    <!-- Quiz Area -->
    <div id="quizArea" class="hidden">
      <div class="quiz-header">
        <div class="question-counter" id="questionCounter">Question 1 of 30</div>
        <div class="timer" id="timer">30:00</div>
      </div>
      
      <div class="question-content">
        <div class="question-text" id="questionText"></div>
        <div class="options-grid" id="optionsContainer"></div>
      </div>
      
      <div class="controls">
        <div class="nav-buttons">
          <button type="button" id="prevBtn" class="secondary">‚Üê Previous</button>
          <button type="button" id="nextBtn">Next ‚Üí</button>
        </div>
        <button type="button" id="submitBtn" class="hidden">üéØ Submit Quiz</button>
      </div>
    </div>

    <!-- Results Area -->
    <div id="resultsArea" class="results hidden">
      <h1>üéâ Quiz Completed!</h1>
      <div id="scoreDisplay" class="score-display"></div>
      <div id="summaryContainer" class="summary"></div>
    </div>

    <!-- Footer -->
    <footer>
      <p><strong>Yeriel Bracha Coding Club</strong><br>¬© 2025 - Excellence in Computing Education</p>
    </footer>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCY9oturc9bql33PSUkfNUptcHXla2RWN4",
      authDomain: "tracha-xx.firebaseapp.com",
      databaseURL: "https://tracha-xx-default-rtdb.firebaseio.com",
      projectId: "tracha-xx",
      storageBucket: "tracha-xx.appspot.com",
      messagingSenderId: "914440906583",
      appId: "1:914440906583:web:123abc456xyz"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Quiz Configuration
    const QUIZ_DURATION = 30 * 60; // 30 minutes in seconds
    const TOTAL_QUESTIONS = 30; // Show 30 out of 40 questions
    const MAX_SCORE = TOTAL_QUESTIONS;
    const COOLDOWN_HOURS = 12;

    // Quiz Data - All 40 questions
    const quizData = [
      {
        q: "1. The main reason for storing data in folders is to ________.",
        options: [
          "Save time when searching for files",
          "Decorate the desktop",
          "Delete all old files",
          "Change the wallpaper"
        ],
        answer: "Save time when searching for files"
      },
      {
        q: "2. A computer user who wants to hear sound from the system will use a ________.",
        options: ["Microphone", "Speaker", "Flash drive", "Keyboard"],
        answer: "Speaker"
      },
      {
        q: "3. When you double-click a program icon, what happens?",
        options: [
          "The file opens",
          "The file is deleted",
          "The desktop closes",
          "The computer shuts down"
        ],
        answer: "The file opens"
      },
      {
        q: "4. Which part of the computer accepts instructions from the user?",
        options: ["CPU", "Output device", "Input device", "Hard disk"],
        answer: "Input device"
      },
      {
        q: "5. The correct order of data processing is ________.",
        options: [
          "Input ‚Üí Processing ‚Üí Output",
          "Output ‚Üí Input ‚Üí Processing",
          "Processing ‚Üí Output ‚Üí Input",
          "Storage ‚Üí Input ‚Üí Output"
        ],
        answer: "Input ‚Üí Processing ‚Üí Output"
      },
      {
        q: "6. An example of a storage device is ________.",
        options: ["Mouse", "Hard disk", "Keyboard", "Printer"],
        answer: "Hard disk"
      },
      {
        q: "7. The Recycle Bin is mainly used to ________.",
        options: [
          "Store deleted files temporarily",
          "Print deleted files",
          "Rename folders",
          "Play music files"
        ],
        answer: "Store deleted files temporarily"
      },
      {
        q: "8. Which key combination is used to copy a file on a computer?",
        options: ["Ctrl + C", "Ctrl + V", "Ctrl + D", "Ctrl + P"],
        answer: "Ctrl + C"
      },
      {
        q: "9. A learner wants to record a short video of an experiment. Which tool is best?",
        options: ["Webcam", "Scanner", "Printer", "Speaker"],
        answer: "Webcam"
      },
      {
        q: "10. The small arrow that moves on the screen when using a mouse is called ________.",
        options: ["Pointer", "Window", "Folder", "Menu"],
        answer: "Pointer"
      },
      {
        q: "11. The main reason for using a mouse pad is to ________.",
        options: [
          "Help the mouse move smoothly",
          "Clean the mouse",
          "Turn off the computer",
          "Stop viruses"
        ],
        answer: "Help the mouse move smoothly"
      },
      {
        q: "12. A flash drive is used for ________.",
        options: [
          "Playing sound",
          "Storing and transferring data",
          "Printing files",
          "Viewing pictures only"
        ],
        answer: "Storing and transferring data"
      },
      {
        q: "13. Which of these is NOT a source of data?",
        options: ["Observation", "Interview", "Guessing", "Experiment"],
        answer: "Guessing"
      },
      {
        q: "14. When files are well-organized, the computer becomes ________.",
        options: [
          "Faster and easier to use",
          "Slower",
          "Heavier",
          "Unable to save data"
        ],
        answer: "Faster and easier to use"
      },
      {
        q: "15. The tool used to type words and numbers into the computer is the ________.",
        options: ["Keyboard", "Mouse", "Monitor", "Flash drive"],
        answer: "Keyboard"
      },
      {
        q: "16. Which of these devices produces soft copy output?",
        options: ["Speaker", "Monitor", "Printer", "Projector"],
        answer: "Monitor"
      },
      {
        q: "17. Which of the following can be used to save voice recordings?",
        options: ["Microphone", "Scanner", "Keyboard", "Printer"],
        answer: "Microphone"
      },
      {
        q: "18. A good example of an optical disc is ________.",
        options: ["CD-ROM", "USB", "Flash card", "Hard disk"],
        answer: "CD-ROM"
      },
      {
        q: "19. The term ‚Äúmanipulate data‚Äù means ________.",
        options: [
          "Working on data to get information",
          "Erasing data permanently",
          "Printing data only",
          "Saving data into folders"
        ],
        answer: "Working on data to get information"
      },
      {
        q: "20. The main unit that controls all computer activities is the ________.",
        options: ["CPU", "Keyboard", "Speaker", "Monitor"],
        answer: "CPU"
      },
      {
        q: "21. The second generation of computers used ________.",
        options: ["Transistors", "Vacuum tubes", "Integrated circuits", "Microprocessors"],
        answer: "Transistors"
      },
      {
        q: "22. To rename a folder, you should ________.",
        options: [
          "Right-click and select ‚ÄúRename‚Äù",
          "Delete the folder",
          "Move it to Recycle Bin",
          "Double-click the icon"
        ],
        answer: "Right-click and select ‚ÄúRename‚Äù"
      },
      {
        q: "23. Which of these can be used to collect data from people?",
        options: ["Questionnaire", "Monitor", "Printer", "Speaker"],
        answer: "Questionnaire"
      },
      {
        q: "24. A well-designed desktop should be ________.",
        options: [
          "Neat and organized",
          "Full of icons",
          "Completely empty",
          "Hidden from users"
        ],
        answer: "Neat and organized"
      },
      {
        q: "25. The part of the CPU that carries out calculations is the ________.",
        options: [
          "Arithmetic and Logic Unit",
          "Control Unit",
          "Memory Unit",
          "Input Unit"
        ],
        answer: "Arithmetic and Logic Unit"
      },
      {
        q: "26. The third generation of computers used ________.",
        options: ["Integrated circuits", "Microprocessors", "Vacuum tubes", "Chips"],
        answer: "Integrated circuits"
      },
      {
        q: "27. What is the best way to find the average of several numbers?",
        options: [
          "Add them and divide by their count",
          "Multiply all together",
          "Subtract the largest from smallest",
          "Divide by 100"
        ],
        answer: "Add them and divide by their count"
      },
      {
        q: "28. A folder can contain ________.",
        options: [
          "Files and other folders",
          "Only music",
          "Only pictures",
          "Only videos"
        ],
        answer: "Files and other folders"
      },
      {
        q: "29. When the teacher uses Excel to find totals and averages, she is ________.",
        options: [
          "Manipulating data",
          "Typing a story",
          "Drawing a chart",
          "Formatting the desktop"
        ],
        answer: "Manipulating data"
      },
      {
        q: "30. The use of microprocessors in computers led to ________.",
        options: [
          "Faster and smaller computers",
          "Bigger and slower computers",
          "Computers without screens",
          "Computers that cannot store data"
        ],
        answer: "Faster and smaller computers"
      }
    ];

    // Global Variables
    let studentName = "";
    let currentQuestion = 0;
    let selectedQuestions = [];
    let userAnswers = [];
    let quizTimer;
    let timeRemaining = QUIZ_DURATION;
    let quizStarted = false;

    // DOM Elements
    const namePage = document.getElementById("namePage");
    const welcomePage = document.getElementById("welcomePage");
    const countdownScreen = document.getElementById("countdownScreen");
    const quizArea = document.getElementById("quizArea");
    const resultsArea = document.getElementById("resultsArea");
    const lockMessage = document.getElementById("lockMessage");

    // Quiz Elements
    const questionCounter = document.getElementById("questionCounter");
    const timer = document.getElementById("timer");
    const questionText = document.getElementById("questionText");
    const optionsContainer = document.getElementById("optionsContainer");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const submitBtn = document.getElementById("submitBtn");

    // Results Elements
    const scoreDisplay = document.getElementById("scoreDisplay");
    const summaryContainer = document.getElementById("summaryContainer");

    // Utility Functions
    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remainingSeconds = seconds % 60;
      return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
    }

    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // Check Student Eligibility
    async function checkStudentEligibility(name) {
      try {
        const studentRef = ref(db, `quizResults`);
        const snapshot = await get(studentRef);
        
        if (!snapshot.exists()) {
          return { canTake: true };
        }

        const allScores = snapshot.val();
        const studentScores = Object.values(allScores).filter(score => 
          score.name && score.name.toLowerCase() === name.toLowerCase()
        );

        if (studentScores.length === 0) {
          return { canTake: true };
        }

        // Find most recent submission
        const lastSubmission = studentScores.sort((a, b) => 
          new Date(b.date) - new Date(a.date)
        )[0];

        const lastSubmissionTime = new Date(lastSubmission.date);
        const now = new Date();
        const timeDiff = now - lastSubmissionTime;
        const hoursDiff = timeDiff / (1000 * 60 * 60);

        if (hoursDiff < COOLDOWN_HOURS) {
          const remainingTime = (COOLDOWN_HOURS * 60 * 60 * 1000) - timeDiff;
          return { 
            canTake: false, 
            remainingTime: remainingTime,
            lastScore: lastSubmission.total || 0,
            maxScore: lastSubmission.maxScore || MAX_SCORE,
            lastPercentage: Math.round((lastSubmission.total || 0)/(lastSubmission.maxScore || MAX_SCORE)*100)
          };
        }

        return { canTake: true };
      } catch (error) {
        console.error("Error checking eligibility:", error);
        return { canTake: true };
      }
    }

    // Event Listeners
    document.getElementById("proceedBtn").addEventListener("click", async () => {
      const nameInput = document.getElementById("studentName").value.trim();
      if (!nameInput) {
        alert("Please enter your name before proceeding!");
        return;
      }
      
      studentName = nameInput;
      const eligibility = await checkStudentEligibility(studentName);
      
      if (!eligibility.canTake) {
        const hours = Math.floor(eligibility.remainingTime / (1000 * 60 * 60));
        const minutes = Math.floor((eligibility.remainingTime % (1000 * 60 * 60)) / (1000 * 60));
        
        lockMessage.classList.remove("hidden");
        lockMessage.innerHTML = `
          <p>‚è∞ You have already completed this quiz recently.</p>
          <p>Last Score: ${eligibility.lastScore}/${TOTAL_QUESTIONS} (${eligibility.lastPercentage}%)</p>
          <p>You can try again in: ${hours}h ${minutes}m</p>
        `;
        return;
      }

      namePage.classList.add("hidden");
      welcomePage.classList.remove("hidden");
    });

    document.getElementById("startBtn").addEventListener("click", () => {
      welcomePage.classList.add("hidden");
      startCountdown();
    });

    // Countdown Function
    function startCountdown() {
      countdownScreen.classList.remove("hidden");
      let counter = 3;
      countdownScreen.textContent = `Get Ready... ${counter}`;

      const countdown = setInterval(() => {
        counter--;
        if (counter > 0) {
          countdownScreen.textContent = `${counter}...`;
        } else {
          clearInterval(countdown);
          countdownScreen.textContent = "Begin!";
          setTimeout(() => {
            countdownScreen.classList.add("hidden");
            initializeQuiz();
          }, 800);
        }
      }, 1000);
    }

    // Initialize Quiz
    function initializeQuiz() {
      // Select 30 random questions from the 40 available
      const shuffledQuestions = shuffleArray(quizData);
      selectedQuestions = shuffledQuestions.slice(0, TOTAL_QUESTIONS);
      userAnswers = new Array(TOTAL_QUESTIONS).fill(null);
      currentQuestion = 0;
      quizStarted = true;
      
      quizArea.classList.remove("hidden");
      loadQuestion();
      startTimer();
      
      // Prevent page refresh
      window.addEventListener('beforeunload', function (e) {
        if (quizStarted) {
          e.preventDefault();
          e.returnValue = '';
        }
      });
    }

    // Load Question
    function loadQuestion() {
      const question = selectedQuestions[currentQuestion];
      
      // Update counter
      questionCounter.textContent = `Question ${currentQuestion + 1} of ${TOTAL_QUESTIONS}`;
      
      // Update question text
      questionText.textContent = question.q;
      
      // Clear and populate options
      optionsContainer.innerHTML = "";
      question.options.forEach((option, index) => {
        const button = document.createElement("button");
        button.className = "option-button secondary";
        button.textContent = option;
        
        if (userAnswers[currentQuestion] === option) {
          button.classList.add("selected");
        }
        
        button.addEventListener("click", () => selectAnswer(option));
        optionsContainer.appendChild(button);
      });
      
      // Update navigation buttons
      prevBtn.disabled = currentQuestion === 0;
      
      if (currentQuestion === TOTAL_QUESTIONS - 1) {
        nextBtn.classList.add("hidden");
        submitBtn.classList.remove("hidden");
      } else {
        nextBtn.classList.remove("hidden");
        submitBtn.classList.add("hidden");
      }
    }

    // Select Answer
    function selectAnswer(answer) {
      userAnswers[currentQuestion] = answer;
      loadQuestion(); // Refresh to show selection
    }

    // Navigation
    prevBtn.addEventListener("click", () => {
      if (currentQuestion > 0) {
        currentQuestion--;
        loadQuestion();
      }
    });

    nextBtn.addEventListener("click", () => {
      if (currentQuestion < TOTAL_QUESTIONS - 1) {
        currentQuestion++;
        loadQuestion();
      }
    });

    submitBtn.addEventListener("click", () => {
      if (confirm("Are you sure you want to submit your quiz? You cannot change answers after submission.")) {
        finishQuiz();
      }
    });

    // Timer Functions
    function startTimer() {
      updateTimerDisplay();
      quizTimer = setInterval(() => {
        timeRemaining--;
        updateTimerDisplay();
        
        if (timeRemaining <= 0) {
          clearInterval(quizTimer);
          autoSubmitQuiz();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      timer.textContent = formatTime(timeRemaining);
      
      // Add warning class for last 5 minutes
      if (timeRemaining <= 300) {
        timer.classList.add("warning");
      }
    }

    function stopTimer() {
      if (quizTimer) {
        clearInterval(quizTimer);
      }
    }

    // Auto Submit
    function autoSubmitQuiz() {
      alert("Time's up! Your quiz will be submitted automatically.");
      finishQuiz(true);
    }

    // Finish Quiz
    async function finishQuiz(isAutoSubmit = false) {
      quizStarted = false;
      stopTimer();
      
      quizArea.classList.add("hidden");
      resultsArea.classList.remove("hidden");
      
      // Calculate score
      let correctAnswers = 0;
      const reviewHTML = [];
      
      selectedQuestions.forEach((question, index) => {
        const userAnswer = userAnswers[index] || "(No answer)";
        const isCorrect = userAnswer === question.answer;
        
        if (isCorrect) correctAnswers++;
        
        reviewHTML.push(`
          <div class="question-review ${isCorrect ? 'correct' : 'wrong'}">
            <p><strong>Q${index + 1}:</strong> ${question.q}</p>
            <p>Your answer: <span class="${isCorrect ? 'correct' : 'wrong'}">${userAnswer}</span></p>
            <p>Correct answer: <span class="correct">${question.answer}</span></p>
          </div>
        `);
      });
      
      const percentage = Math.round((correctAnswers / TOTAL_QUESTIONS) * 100);
      const timeUsed = QUIZ_DURATION - timeRemaining;
      
      // Display results
      scoreDisplay.innerHTML = `
        <h2>üìä Your Results</h2>
        <p><strong>Student:</strong> ${studentName}</p>
        <p><strong>Score:</strong> ${correctAnswers} / ${TOTAL_QUESTIONS} (${percentage}%)</p>
        <p><strong>Time Used:</strong> ${formatTime(timeUsed)}</p>
        ${isAutoSubmit ? '<p><strong>Status:</strong> Auto-submitted (Time expired)</p>' : ''}
        <p><strong>Grade:</strong> ${percentage >= 70 ? 'üéâ Excellent!' : percentage >= 50 ? 'üëç Good!' : 'üìö Keep studying!'}</p>
      `;
      
      summaryContainer.innerHTML = `
        <h3>üìã Detailed Review</h3>
        ${reviewHTML.join('')}
      `;
      
      // Save to Firebase
      try {
        const newRef = push(ref(db, "quizResults"));
        
        await set(newRef, {
          name: studentName,
          sectionA: correctAnswers,
          sectionB: 0,
          total: correctAnswers,
          percentage: percentage,
          timeUsed: timeUsed,
          autoSubmitted: isAutoSubmit,
          date: new Date().toLocaleString(),
          timestamp: new Date().toISOString(),
          subject: "Introduction to Computing"
        });
        
        // Show success message
        const successDiv = document.createElement('div');
        successDiv.style.cssText = `
          background: rgba(40, 167, 69, 0.9);
          color: white;
          padding: 15px;
          border-radius: 10px;
          margin-top: 20px;
          text-align: center;
          font-weight: 600;
        `;
        successDiv.innerHTML = `‚úÖ Score saved successfully!<br>‚è∞ You can retake this quiz after ${COOLDOWN_HOURS} hours.`;
        resultsArea.appendChild(successDiv);
        
      } catch (error) {
        console.error("Error saving results:", error);
        
        // Show error message
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = `
          background: rgba(220, 53, 69, 0.9);
          color: white;
          padding: 15px;
          border-radius: 10px;
          margin-top: 20px;
          text-align: center;
          font-weight: 600;
        `;
        errorDiv.innerHTML = '‚ö†Ô∏è Quiz completed but could not save to database. Please contact your instructor.';
        resultsArea.appendChild(errorDiv);
      }
    }
  </script>
</body>
</html>
