<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ceebody Quiz</title>
<style>
  /* ===== General Styles ===== */
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #ff7b00 0%, #ff9500 50%, #ffb347 100%);
    min-height:100vh;
    padding:20px;
  }
  .container {
    width:90%; max-width:900px; margin:0 auto;
    background: rgba(255,255,255,0.95); padding:30px;
    border-radius:20px; box-shadow:0 20px 40px rgba(0,0,0,0.15);
    backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.2);
  }
  h1 { text-align:center; color:#2c3e50; margin-bottom:20px; font-size:2.2em; font-weight:700; text-shadow:2px 2px 4px rgba(0,0,0,0.1); }
  h2 { color:#34495e; margin-bottom:20px; font-size:1.3em; text-align:center; }
  .hidden { display:none; }
  input[type="text"] {
    width:100%; max-width:400px; padding:15px; border-radius:10px; border:2px solid #bdc3c7;
    font-size:1.1em; margin:15px auto; display:block; transition:border-color 0.3s ease;
  }
  input[type="text"]:focus { outline:none; border-color:#ff7b00; box-shadow:0 0 0 3px rgba(255,123,0,0.1); }
  button {
    background: linear-gradient(135deg, #ff7b00, #ff9500); color:white; border:none;
    padding:15px 30px; border-radius:50px; cursor:pointer; font-size:1.1em; font-weight:600; margin:10px;
    transition:all 0.3s ease; text-transform:uppercase; letter-spacing:1px;
  }
  button:hover { background: linear-gradient(135deg,#ff9500,#ff7b00); transform: translateY(-2px); box-shadow:0 10px 30px rgba(255,123,0,0.4); }
  button:disabled { background:#95a5a6; cursor:not-allowed; transform:none; box-shadow:none; }
  button.secondary { background:#ecf0f1; color:#2c3e50; text-transform:none; letter-spacing:normal; padding:12px 20px; margin:5px; border-radius:10px; font-weight:normal; }
  button.secondary:hover { background:#bdc3c7; transform: translateY(-1px); }
  button.selected { background: linear-gradient(135deg,#27ae60,#2ecc71) !important; color:white !important; }

  .name-section, .welcome-content, .countdown-screen, .quiz-header, .question-content, .controls, .results { text-align:center; }
  .quiz-info { background: rgba(255,123,0,0.1); border:2px solid #ff7b00; border-radius:15px; padding:20px; margin:20px 0; }
  .quiz-info p { margin:10px 0; font-size:1.1em; color:#2c3e50; }
  marquee { background: linear-gradient(135deg, #ff7b00, #ff9500); color:white; padding:10px; border-radius:8px; margin:15px 0; font-weight:bold; }
  .countdown-screen { font-size:4em; font-weight:bold; color:#ff7b00; animation:pulse 1s ease-in-out infinite; padding:60px 20px; }
  @keyframes pulse { 0%,100% { transform:scale(1); opacity:0.8 } 50% { transform:scale(1.1); opacity:1 } }

  .quiz-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; padding:15px; background: rgba(255,123,0,0.1); border-radius:10px; }
  .question-counter { font-weight:bold; color:#2c3e50; font-size:1.1em; }
  .timer { font-weight:bold; color:#e74c3c; font-size:1.2em; padding:8px 15px; background: rgba(231,76,60,0.1); border-radius:20px; }
  .timer.warning { animation: blink 1s infinite; }
  @keyframes blink { 0%,50% { opacity:1 } 51%,100% { opacity:0.5 } }

  .question-content { background: rgba(255,255,255,0.8); padding:25px; border-radius:15px; margin-bottom:25px; border-left:5px solid #ff7b00; }
  .instruction-text { font-size:1.15em; color:#2c3e50; font-weight:600; line-height:1.6; text-align:center; }
  .question-text { font-size:1.2em; color:#2c3e50; font-weight:600; line-height:1.5; margin-bottom:20px; }
  .options-grid { display:grid; grid-template-columns:1fr; gap:10px; margin-bottom:25px; }
  .option-button { text-align:left; padding:15px 20px; border-radius:10px; font-size:1em; line-height:1.4; word-wrap:break-word; }

  .controls { display:flex; justify-content:space-between; align-items:center; margin-top:30px; flex-wrap:wrap; }
  .nav-buttons { display:flex; gap:10px; }

  .results { padding:20px; }
  .score-display { background: linear-gradient(135deg,#2ecc71,#27ae60); color:white; padding:25px; border-radius:15px; margin:20px 0; font-size:1.3em; }
  .summary { text-align:left; margin-top:30px; padding:20px; background: rgba(236,240,241,0.8); border-radius:15px; }
  .summary h3 { color:#2c3e50; margin-bottom:20px; text-align:center; font-size:1.4em; }
  .question-review { margin:15px 0; padding:15px; background:white; border-radius:10px; border-left:4px solid #bdc3c7; }
  .question-review.correct { border-left-color:#27ae60; }
  .question-review.wrong { border-left-color:#e74c3c; }
  .correct { color:#27ae60; font-weight:bold; }
  .wrong { color:#e74c3c; font-weight:bold; }

  footer { text-align:center; margin-top:40px; padding:20px; background: linear-gradient(135deg,#2c3e50,#34495e); color:white; border-radius:15px; font-size:14px; }
  .lock-message { text-align:center; color:#e74c3c; font-weight:bold; background: rgba(231,76,60,0.1); padding:15px; border-radius:10px; margin-top:15px; }

  @media(max-width:768px){
    .container { padding:20px; margin:10px; width:calc(100% - 20px); }
    h1 { font-size:1.8em; }
    .countdown-screen { font-size:3em; padding:40px 20px; }
    .quiz-header { flex-direction:column; gap:10px; }
    .controls { flex-direction:column; gap:15px; }
    .nav-buttons { width:100%; justify-content:space-between; }
    button { padding:12px 20px; font-size:1em; }
  }
</style>
</head>
<body>
<div class="container">

  <!-- Name Input -->
  <div id="namePage" class="name-section">
    <h1>üéì English Objective Quiz</h1>
    <p>Welcome! Please enter your full name to begin the quiz.</p>
    <input type="text" id="studentName" placeholder="Enter your full name"/>
    <button id="proceedBtn">Proceed to Quiz</button>
    <div id="lockMessage" class="lock-message hidden"></div>
  </div>

  <!-- Welcome -->
  <div id="welcomePage" class="welcome-content hidden">
    <h1>Welcome to Quizzilla! üöÄ</h1>
    <div class="quiz-info">
      <p>üìö <strong>Subject:</strong> English Objectives</p>
      <marquee>Just select the correct answer for each question!</marquee>
      <p>‚è±Ô∏è <strong>Time Limit:</strong> 50 minutes</p>
      <p>‚ùì <strong>Questions:</strong> 60 questions</p>
      <p>üéØ <strong>Instructions:</strong> Use Next and Previous to navigate, click Submit when done</p>
    </div>
    <button id="startBtn">üéØ Sure, Let's Start Quiz!</button>
  </div>

  <!-- Countdown -->
  <div id="countdownScreen" class="countdown-screen hidden"></div>

  <!-- Quiz Area -->
  <div id="quizArea" class="hidden">
    <div class="quiz-header">
      <div class="question-counter" id="questionCounter">Question 1 of 60</div>
      <div class="timer" id="timer">50:00</div>
    </div>
    <div class="question-content">
      <div class="instruction-text hidden" id="instructionText"></div>
      <div class="question-text" id="questionText"></div>
      <div class="options-grid" id="optionsContainer"></div>
    </div>
    <div class="controls">
      <div class="nav-buttons">
        <button id="prevBtn" class="secondary">‚Üê Previous</button>
        <button id="nextBtn">Next ‚Üí</button>
      </div>
      <button id="submitBtn" class="hidden">üéØ Submit Quiz</button>
    </div>
  </div>

  <!-- Results -->
  <div id="resultsArea" class="results hidden">
    <h1>üéâ Quiz Completed!</h1>
    <div id="scoreDisplay" class="score-display"></div>
    <div id="summaryContainer" class="summary"></div>
  </div>

  <footer>
    <p><strong>Ceebody Tech</strong><br>¬© 2025 - Excellence in Digital Education</p>
  </footer>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCY9oturc9bql33PSUkfNUptcHXla2RWN4",
  authDomain: "tracha-xx.firebaseapp.com",
  databaseURL: "https://tracha-xx-default-rtdb.firebaseio.com",
  projectId: "tracha-xx",
  storageBucket: "tracha-xx.appspot.com",
  messagingSenderId: "914440906583",
  appId: "1:914440906583:web:123abc456xyz"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== CONFIG =====
const QUIZ_DURATION = 50*60;
const COOLDOWN_HOURS = 12;

// ===== QUESTIONS =====
const items = [
    // SECTION A: Instructions
  { type:'instruction', text:'SECTION A: Complete each sentence.' },
  { type:'question', q:'1. All work and no play makes Jack a dull boy, ________?', options:['Shan‚Äôt it','Isn‚Äôt it','Doesn‚Äôt it','Can‚Äôt it'], answer:'Doesn‚Äôt it' },
  { type:'question', q:'2. You cannot swim in the sea, ________ you?', options:['Couldn‚Äôt','Can','Don‚Äôt','Did'], answer:'Can' },
  { type:'question', q:'3. It is no use ________ over spilt milk.', options:['Cry','Of crying','Crying','To cry'], answer:'Crying' },
  { type:'question', q:'4. Some of the pineapples are ________ sour to be eaten.', options:['More so','More too','Much too','Much so'], answer:'Much too' },
  { type:'question', q:'5. ________, learners must behave well.', options:['The last but not least','The last but not the least','Last but not least','Last but not the least'], answer:'Last but not least' },
  { type:'question', q:'6. Where ________ Asana and Betty spending their next holiday?', options:['Is','Are','Were','Was'], answer:'Are' },
  { type:'question', q:'7. The messenger did not ________ anyone in the house.', options:['Meet','Met','Meets','Meeting'], answer:'Meet' },
  { type:'question', q:'8. She lives in her ________ house.', options:["Father-in-laws‚Äô","Fathers-in-laws‚Äô","Father‚Äôs-in-law‚Äôs","Father-in-law‚Äôs"], answer:'Father-in-law‚Äôs' },
  { type:'question', q:'9. Their sister wore a ________ to the party.', options:['Beautiful silk pink dress','Silk pink beautiful dress','Pink beautiful dress','Beautiful pink silk dress'], answer:'Beautiful pink silk dress' },
  { type:'question', q:'10. It was ________ late to go out alone.', options:['Too','Very','Much','So'], answer:'Too' },
  { type:'question', q:'11. This is the boy ________ rescued us.', options:['Whose','Which','Whom','Who'], answer:'Who' },
  { type:'question', q:'12. The nurse made me ________ a lot of water.', options:['Drink','Drank','Drunk','To drink'], answer:'Drink' },
  { type:'question', q:'13. It is not easy to identify ________ voice it was.', options:['Who','Whom','Who‚Äôs','Whose'], answer:'Whose' },
  { type:'question', q:'14. Neither the parents nor the child ________ at home yesterday.', options:['Are','Is','Were','Was'], answer:'Was' },
  { type:'question', q:'15. Her clothes would look better if she ________ them.', options:['Will wash','Washes','Washed','Would wash'], answer:'Washed' },

  // SECTION B: Synonyms
  { type:'instruction', text:'SECTION B: Choose from the alternatives lettered A to D the one which is nearest in meaning to the underlined word.' },
  { type:'question', q:'16. We will not allow him to _dampen_ our spirits.', options:['Suppress','Break','Destroy','Lower'], answer:'Lower' },
  { type:'question', q:'17. The _commotion_ at the stadium was avoidable.', options:['Trouble','Confusion','Issue','Violence'], answer:'Confusion' },
  { type:'question', q:'18. What _transpired_ between them remains a secret.', options:['Manifested','Translated','Existed','Happened'], answer:'Happened' },
  { type:'question', q:'19. Lance only talks about _trivial_ matters.', options:['Unimportant','Unpleasant','Unacceptable','Unexciting'], answer:'Unimportant' },
  { type:'question', q:'20. The robber _ransacked_ the house.', options:['Torched','Destroyed','Invaded','Looted'], answer:'Looted' },

  // SECTION C: Idioms
  { type:'instruction', text:'SECTION C: Choose the one that best explains the underlined group of words.' },
  { type:'question', q:'21. I was informed _at the eleventh hour_ about his decision to leave town.', options:['Very late','At eleven o‚Äôclock','Immediately','In good time'], answer:'Very late' },
  { type:'question', q:'22. We tried all we could to amuse her but she _kept a straight face_.', options:['Did not listen to us','Looked straight ahead','Refused to laugh','Cried all the more'], answer:'Refused to laugh' },
  { type:'question', q:'23. She had gone away _bag and baggage_.', options:['Leaving all her children','Leaving all her belongings','Without informing anyone','With all her belongings'], answer:'With all her belongings' },
  { type:'question', q:'24. She can see _no further than her nose_.', options:['Lacks foresight','Is easily deceived','Has a long nose','Cannot think'], answer:'Lacks foresight' },
  { type:'question', q:'25. Yaro was left _to sink or swim_.', options:['Find another job','Shout for help','Survive on his own','Become depressed'], answer:'Survive on his own' },

  // SECTION D: Antonyms
  { type:'instruction', text:'SECTION D: Choose the word that is most nearly opposite in meaning to the underlined word.' },
  { type:'question', q:'26. She _accidentally_ tore her dress.', options:['Intentionally','Willingly','Carelessly','Foolishly'], answer:'Intentionally' },
  { type:'question', q:'27. The story was written in _simple_ language.', options:['Foreign','Strange','Local','Complex'], answer:'Complex' },
  { type:'question', q:'28. The _arrogant_ storekeeper lost all his customers.', options:['Respectful','Obedient','Modest','Sympathetic'], answer:'Modest' },
  { type:'question', q:'29. We _finished_ several projects last year.', options:['Initiated','Concluded','Stopped','Organized'], answer:'Initiated' },
  { type:'question', q:'30. The _unfavourable_ weather affected their health.', options:['Beautiful','Pleasant','Cool','Promising'], answer:'Pleasant' },

  // SECTION E: Sentence Completion (31-60)
  { type:'instruction', text:'From the alternatives lettered A to D, choose the one which most suitably completes each sentence.' },
  { type:'question', q:'31. If the family house had been maintained properly, it ....... collapsed.', options:['will not have','has not','had not','would not have'], answer:'would not have' },
  { type:'question', q:'32. She bakes bread as a means ........ making an extra income.', options:['for','in','to','of'], answer:'of' },
  { type:'question', q:'33. Deon said he heard the parrot .....', options:['sing','sang','sung','to sing'], answer:'sing' },
  { type:'question', q:'34. People who live in unhygienic environments easily ... Cholera.', options:['catch','attract','capture','contract'], answer:'catch' },
  { type:'question', q:'35. There is ... water in the fridge.', options:['a few','few','a lot','a little'], answer:'a little' },
  { type:'question', q:'36. Remy looks forward to .... Jane at the party.', options:['seeing','see','have been seeing','be seeing'], answer:'seeing' },
  { type:'question', q:'37. The students did not give any reason ...... being late.', options:['to','of','for','in'], answer:'for' },
  { type:'question', q:'38. What ..... Kwadwo and Adwoa doing when you left the shop?', options:['are','were','was','is'], answer:'were' },
  { type:'question', q:'39. Selfish people always consider .... first.', options:['herself','ourselves','myself','themselves'], answer:'themselves' },
  { type:'question', q:'40. Enyonam asked her friend to ..... her a pen.', options:['lend','spare','borrow','excuse'], answer:'lend' },
  { type:'question', q:'41. The accident occurred ...... the driver\'s mistakes.', options:['from','on','through','by'], answer:'through' },
  { type:'question', q:'42. I know you are ......, Esi.', options:['taller','tallest','the taller','the tall'], answer:'taller' },
  { type:'question', q:'43. Akesi\'s mother was not satisfied ... his explanation.', options:['in','to','with','on'], answer:'with' },
  { type:'question', q:'44. I have been in this country ....... three years.', options:['through','within','for','since'], answer:'for' },
  { type:'question', q:'45. Their gardener was ..... old to work.', options:['even','so','too','very'], answer:'too' },
  { type:'question', q:'46. Her _ambition_ is to own a private jet.', options:['target','joy','plan','desire'], answer:'desire' },
  { type:'question', q:'47. Have you _enough_ money to buy a house?', options:['plenty','much','sufficient','full'], answer:'sufficient' },
  { type:'question', q:'48. Mr Nunyah _slaughtered_ some of his bulls.', options:['killed','treated','examined','castrated'], answer:'killed' },
  { type:'question', q:'49. Soraya is very _lively_ today.', options:['smart','active','friendly','serious'], answer:'active' },
  { type:'question', q:'50. The _welfare_ of their students should be the concern of teachers.', options:['wealth','happiness','well-being','growth'], answer:'well-being' },
  { type:'question', q:'51. Paul _shed crocodile tears_ when his friend failed the exam.', options:['was genuinely sorry for his friend.','felt very sad but did not cry.','pretended he was sorry for his friend.','cried uncontrollably.'], answer:'pretended he was sorry for his friend.' },
  { type:'question', q:'52. When the old woman heard the sound of the gun-shots, her _hair stood on end_.', options:['started crying.','became inactive.','was frightened.','was worried.'], answer:'was frightened.' },
  { type:'question', q:'53. That tailor always _takes pains_ over his sewing.', options:['does his sewing with great care.','finds sewing very painful.','is not happy sewing.','is often ill and cannot sew.'], answer:'does his sewing with great care.' },
  { type:'question', q:'54. These herbs grow here _in leaps and bounds_.', options:['gradually and in small numbers.','in big circular heaps.','in both cold and hot weather.','quickly and greatly.'], answer:'quickly and greatly.' },
  { type:'question', q:'55. Kim is _full of himself_.', options:['arrogant','dangerous','greedy','quarrelsome'], answer:'arrogant' },
  { type:'question', q:'56. Evans wakes up _early_ because he does not sleep much.', options:['often','at home','late','on his bed'], answer:'late' },
  { type:'question', q:'57. Dora was _exhausted_ after the exercise.', options:['cheerful','active','refreshed','strong'], answer:'refreshed' },
  { type:'question', q:'58. The _demolition_ of the bridge surprised everyone.', options:['construction','creation','erection','relocation'], answer:'construction' },
  { type:'question', q:'59. They said the film was _ancient_ but I found it...', options:['relaxing','modern','difficult','interesting'], answer:'modern' },
  { type:'question', q:'60. The animal will _perish_ under this condition.', options:['graze','survive','starve','remain'], answer:'survive' }
];




// Automatically map question positions
const questionPositions = items.map((it,i)=>it.type==='question'?i:null).filter(i=>i!==null);
const MAX_SCORE = questionPositions.length;

// ===== STATE =====
let studentName = "", currentItemIndex=0, quizStarted=false, timeRemaining=QUIZ_DURATION, quizTimer=null;
let userAnswers = new Array(MAX_SCORE).fill(null);

// ===== DOM =====
const namePage=document.getElementById("namePage"), welcomePage=document.getElementById("welcomePage");
const countdownScreen=document.getElementById("countdownScreen"), quizArea=document.getElementById("quizArea");
const resultsArea=document.getElementById("resultsArea"), lockMessage=document.getElementById("lockMessage");
const questionCounter=document.getElementById("questionCounter"), timer=document.getElementById("timer");
const questionText=document.getElementById("questionText"), instructionText=document.getElementById("instructionText");
const optionsContainer=document.getElementById("optionsContainer");
const prevBtn=document.getElementById("prevBtn"), nextBtn=document.getElementById("nextBtn"), submitBtn=document.getElementById("submitBtn");
const scoreDisplay=document.getElementById("scoreDisplay"), summaryContainer=document.getElementById("summaryContainer");

// ===== UTIL =====
function formatTime(sec){ const m=Math.floor(sec/60); const s=sec%60; return `${m}:${s.toString().padStart(2,'0')}`; }
function getQuestionIndex(){ return questionPositions.indexOf(currentItemIndex); }
function getCurrentQuestionNumber(){ const idx=getQuestionIndex(); return idx===-1?null:idx+1; }

// ===== ELIGIBILITY =====
async function checkStudentEligibility(name){
  try {
    const snapshot=await get(ref(db,'quizResults'));
    if(!snapshot.exists()) return {canTake:true};
    const allScores=Object.values(snapshot.val());
    const studentScores=allScores.filter(s=>s.name?.toLowerCase()===name.toLowerCase());
    if(studentScores.length===0) return {canTake:true};
    const last=submission=studentScores.sort((a,b)=>new Date(b.date)-new Date(a.date))[0];
    const diff=(new Date()-new Date(last.date))/(1000*60*60);
    if(diff<COOLDOWN_HOURS){
      return {canTake:false, remainingTime:(COOLDOWN_HOURS*60*60*1000)-(new Date()-new Date(last.date)), lastScore:last.total||0, lastPercentage:Math.round((last.total||0)/(last.maxScore||MAX_SCORE)*100)};
    }
    return {canTake:true};
  } catch(e){ console.error(e); return {canTake:true}; }
}

// ===== EVENTS =====
document.getElementById("proceedBtn").addEventListener("click", async ()=>{
  const nameInput=document.getElementById("studentName").value.trim();
  if(!nameInput){ alert("Please enter your name!"); return; }
  studentName=nameInput;
  const eligibility=await checkStudentEligibility(studentName);
  if(!eligibility.canTake){
    lockMessage.classList.remove('hidden');
    const h=Math.floor(eligibility.remainingTime/(1000*60*60));
    const m=Math.floor((eligibility.remainingTime%(1000*60*60))/(1000*60));
    lockMessage.innerHTML=`<p>‚è∞ Already completed quiz recently.</p><p>Last Score: ${eligibility.lastScore}/${MAX_SCORE} (${eligibility.lastPercentage}%)</p><p>Try again in: ${h}h ${m}m</p>`;
    return;
  }
  namePage.classList.add('hidden'); welcomePage.classList.remove('hidden');
});

document.getElementById("startBtn").addEventListener("click", ()=>{ welcomePage.classList.add('hidden'); startCountdown(); });

function startCountdown(){
  countdownScreen.classList.remove('hidden'); let counter=3; countdownScreen.textContent=`Get Ready... ${counter}`;
  const cd=setInterval(()=>{
    counter--; if(counter>0) countdownScreen.textContent=`${counter}...`;
    else { clearInterval(cd); countdownScreen.textContent='Begin!'; setTimeout(()=>{ countdownScreen.classList.add('hidden'); initializeQuiz(); },800);}
  },1000);
}

// ===== QUIZ =====
function initializeQuiz(){
  userAnswers=new Array(MAX_SCORE).fill(null); currentItemIndex=0; quizStarted=true; timeRemaining=QUIZ_DURATION;
  quizArea.classList.remove('hidden'); loadCurrentItem(); startTimer();
  window.addEventListener('beforeunload', e=>{ if(quizStarted){ e.preventDefault(); e.returnValue=''; } });
}

function loadCurrentItem(){
  const item=items[currentItemIndex];
  if(item.type==='instruction'){
    instructionText.classList.remove('hidden'); instructionText.textContent=item.text;
    questionText.classList.add('hidden'); optionsContainer.innerHTML='';
  } else {
    instructionText.classList.add('hidden'); questionText.classList.remove('hidden'); questionText.textContent=item.q;
    optionsContainer.innerHTML='';
    const qIdx=getQuestionIndex(); const selected=userAnswers[qIdx];
    item.options.forEach(opt=>{
      const btn=document.createElement('button');
      btn.className="option-button secondary"; btn.textContent=opt;
      if(selected===opt) btn.classList.add('selected');
      btn.addEventListener('click',()=>selectAnswer(opt));
      optionsContainer.appendChild(btn);
    });
  }
  const qNumber=getCurrentQuestionNumber(); questionCounter.textContent=qNumber?`Question ${qNumber} of ${MAX_SCORE}`:'Instruction';
  prevBtn.disabled=currentItemIndex===0; nextBtn.disabled=currentItemIndex>=items.length-1;
  submitBtn.classList.toggle('hidden',currentItemIndex<items.length-1);
}

function selectAnswer(answer){
  const idx=getQuestionIndex(); if(idx===-1) return;
  userAnswers[idx]=answer;
  Array.from(optionsContainer.children).forEach(btn=>{ btn.classList.toggle('selected',btn.textContent===answer); });
}

prevBtn.addEventListener('click',()=>{ if(currentItemIndex>0) { currentItemIndex--; loadCurrentItem(); } });
nextBtn.addEventListener('click',()=>{ if(currentItemIndex<items.length-1) { currentItemIndex++; loadCurrentItem(); } });
submitBtn.addEventListener('click', submitQuiz);

function startTimer(){
  updateTimerDisplay();
  quizTimer=setInterval(()=>{
    timeRemaining--; if(timeRemaining<=0){ clearInterval(quizTimer); submitQuiz(); return; }
    updateTimerDisplay();
  },1000);
}

function updateTimerDisplay(){
  timer.textContent=formatTime(timeRemaining);
  if(timeRemaining<=300) timer.classList.add('warning'); else timer.classList.remove('warning');
}

async function submitQuiz(){
  clearInterval(quizTimer); quizStarted=false; quizArea.classList.add('hidden'); resultsArea.classList.remove('hidden');

  // Calculate score
  let score=0; const review=[];
  questionPositions.forEach((pos,i)=>{
    const item=items[pos]; const ans=userAnswers[i];
    const correct=item.answer;
    if(ans===correct) score++;
    review.push({q:item.q, selected:ans, correct});
  });

  const percentage=Math.round(score/MAX_SCORE*100);
  scoreDisplay.textContent=`Your Score: ${score}/${MAX_SCORE} (${percentage}%)`;

  // Display summary
  summaryContainer.innerHTML=review.map(r=>`
    <div class="question-review ${r.selected===r.correct?'correct':'wrong'}">
      <p><strong>Q:</strong> ${r.q}</p>
      <p><strong>Your Answer:</strong> ${r.selected||'Not Answered'}</p>
      <p><strong>Correct Answer:</strong> <span class="${r.selected===r.correct?'correct':'wrong'}">${r.correct}</span></p>
    </div>
  `).join('');

  // Save to Firebase
  try {
    const dbRef=ref(db,'quizResults'); 
    await push(dbRef, { name:studentName, total:score, maxScore:MAX_SCORE, percentage, date:new Date().toISOString() });
  } catch(e){ console.error("Error saving result:", e); }
}

</script>
</body>
</html>
